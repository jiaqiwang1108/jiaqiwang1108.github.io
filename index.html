<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<link rel="stylesheet" href="style.css">
<script>
	var questions = [];
	var current_question_id = 0;
	// https://stackoverflow.com/questions/7431268/how-to-read-data-from-csv-file-using-javascript/12289296#12289296
	$(document).ready(function() {
	    $.ajax({
	        type: "GET",
	        url: "Questions_data_prj3.csv",
	        dataType: "text",
	        contentType: "text/plain",
	        success: function(data) { 
	        	getQuestionText(data); 
	        }
	    });

		$.ajax({
	        type: "GET",
	        url: "Answers_data_prj3_update2.csv",
	        dataType: "text",
	        contentType: "text/plain",
	        success: function(data) { 
	        	getAnswerText(data); 
	        }
	    });

		$("#btn-start").click(function(event) {
			$(".welcome-container").hide();
			$(".question-container").show();
	    	showQuestion(event);
		});

	    $("#btn-submit").click(function(event) {
	    	showQuestion(event);
		});
	});

	function getQuestionText(allText) {
		var lines = processData(allText);
		for (var i in lines) {
	    	questions.push({
	    		"question_id": lines[i][1],
	    		"question_text": lines[i][2],
	    		"answers": [],
	    	});
	    }
	    console.log(questions);
	}

	function getAnswerText(allText) {
		var lines = processData(allText);
		for (var i in lines) {
			question_id = lines[i][1];
			questions[question_id-1]["answers"].push(lines[i][0]);
	    }
	    console.log(questions);
	}

	function processData(allText) {
	    var allTextLines = allText.split(/\r\n|\n/);
	    var headers = allTextLines[0].split(',');
	    var lines = [];
	    for (var i=1; i<allTextLines.length; i++) {
	        var data = allTextLines[i].split(',');
            var tarr = [];
            for (var j=0; j<data.length; j++) {
            	var line = data[j];
            	if (data[j][0] == '"') {
            		line = line.substring(1);
            		while (data[j][data[j].length-1] != '"') {
            			line += data[++j];
            		}
            		line = line.substring(0, line.length-1);
            	} 
            	tarr.push(line);
            }
            lines.push(tarr);
	    }
	    return lines;
	}

	function showQuestion(event) {
		shuffle(questions[current_question_id]["answers"]);
		$("#question").text(questions[current_question_id]["question_text"]);
		$("#answer1-text").text(questions[current_question_id]["answers"][0]);
		$("#answer2-text").text(questions[current_question_id]["answers"][1]);
		$("#answer3-text").text(questions[current_question_id]["answers"][2]);
		$("#answer4-text").text(questions[current_question_id]["answers"][3]);
		current_question_id++;
		if (current_question_id == questions.length) {
			current_question_id = 0;
		}
	}

	// https://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array
	function shuffle(a) {
	    var j, x, i;
	    for (i = a.length - 1; i > 0; i--) {
	        j = Math.floor(Math.random() * (i + 1));
	        x = a[i];
	        a[i] = a[j];
	        a[j] = x;
	    }
	    return a;
	}

</script>
</head>
<body>
<!-- https://getbootstrap.com/docs/4.3/components/forms/#checkboxes-and-radios -->
<div class="container">
	<div class="welcome-container">
		<h1>Welcome</h1>
		<button id="btn-start" class="btn btn-primary">Start</button>
	</div>

	<div class="question-container">
		<h3 id="question">Question</h3>
		<div class="form-check">
		  <input class="form-check-input" type="radio" name="answers" id="answer1" value="option1" checked>
		  <label class="form-check-label" for="answer1" id="answer1-text"> Answer 1 </label>
		</div>
		<div class="form-check">
		  <input class="form-check-input" type="radio" name="answers" id="answer2" value="option2">
		  <label class="form-check-label" for="answer2" id="answer2-text"> Answer 2 </label>
		</div>
		<div class="form-check">
		  <input class="form-check-input" type="radio" name="answers" id="answer3" value="option3">
		  <label class="form-check-label" for="answer3" id="answer3-text"> Answer 3 </label>
		</div>
		<div class="form-check">
		  <input class="form-check-input" type="radio" name="answers" id="answer4" value="option4">
		  <label class="form-check-label" for="answer4" id="answer4-text"> Answer 4 </label>
		</div>
		<button id="btn-submit" class="btn btn-primary">Submit</button>
	</div>
</div>
</body>
</html>